{"version":3,"sources":["index.js","networkManage.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _networkManage = _interopRequireDefault(require(\"./networkManage\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst Network = {};\nwx.onAppRoute(() => {\n  // 路由信息更新时，请求队列清空\n  _networkManage.default.clear();\n});\n/**\n * weDebug: weDebug 实例\n * networkCallee: 网络请求方式\n *\n * @class NetworkPlugin\n */\n\nclass NetworkPlugin {\n  constructor(weDebug, options = {}) {\n    this.weDebug = weDebug;\n    this.networkCallee = options.networkCallee || ['request', 'downloadFile', 'uploadFile'];\n    this._store = {\n      infoRuleState: weDebug.createCache('__infoRuleState__')\n    };\n    this._proxyRule = null;\n  }\n  /**\n   * 创建界面\n   *\n   * @memberof NetworkPlugin\n   */\n\n\n  createUI() {\n    const that = this;\n    const {\n      createFormRule,\n      addFormRule\n    } = that.weDebug; // 创建网络环境规则表单\n\n    that._networkRule = createFormRule({\n      title: '调试抓包',\n      desc: '获取本页面所有请求的抓包信息',\n      type: 'button',\n      handler: {\n        bindTap() {\n          wx.setClipboardData({\n            data: JSON.stringify(_networkManage.default.get(), null, 2)\n          });\n        }\n\n      }\n    }); // 添加表单到视图\n\n    addFormRule([that._networkRule]);\n  }\n  /**\n   * 劫持实现逻辑\n   *\n   * @returns\n   * @memberof NetworkPlugin\n   */\n\n\n  createProxy() {\n    this.networkCallee.forEach(method => {\n      const networkFunc = wx[method];\n      Object.defineProperty(wx, method, {\n        get: () => (opt = {}) => this.proxyHandler(networkFunc, opt)\n      });\n    });\n  }\n\n  proxyHandler(networkFunc, opt = {}) {\n    const that = this;\n    const {\n      isFunc\n    } = that.weDebug.util;\n    let out = Object.assign({}, opt);\n\n    if (!out.header) {\n      out.header = {};\n    }\n\n    if (!out.data) {\n      out.data = {};\n    }\n\n    out.success = function (res) {\n      _networkManage.default.add({\n        request: opt,\n        response: res\n      });\n\n      isFunc(opt.success) && opt.success.apply(this, arguments);\n    };\n\n    out.fail = function (err) {\n      _networkManage.default.add({\n        request: opt,\n        response: err\n      });\n\n      isFunc(opt.fail) && opt.fail.apply(this, arguments);\n    };\n\n    return networkFunc.call(this, out);\n  }\n\n}\n\nNetwork.install = function (weDebug, options = {}) {\n  const ins = new NetworkPlugin(weDebug, options);\n  ins.createUI();\n  ins.createProxy();\n};\n\nvar _default = Network;\nexports.default = _default;","\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n// 请求队列管理\nconst requestManage = {\n  _requestQueue: [],\n\n  get() {\n    return this._requestQueue;\n  },\n\n  add(task) {\n    this._requestQueue.push(task);\n  },\n\n  remove(task) {\n    let i = this._requestQueue.length;\n\n    while (i--) {\n      let tmp = this._requestQueue[i];\n\n      if (tmp === task) {\n        this._requestQueue.splice(i, 1);\n\n        break;\n      }\n    }\n  },\n\n  clear() {\n    this._requestQueue = [];\n  }\n\n};\nvar _default = requestManage;\nexports.default = _default;"]}