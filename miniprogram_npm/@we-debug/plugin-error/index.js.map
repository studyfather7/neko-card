{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nconst ErrorPlugin = {};\n/**\n * 异常调试插件\n *\n * @param {*} weDebug\n * @param {*} [options={}]\n */\n\nconst errManage = {\n  _errStack: [],\n\n  get() {\n    return this._errStack;\n  },\n\n  add(e) {\n    this._errStack.push(e);\n  },\n\n  clear() {\n    this._errStack = [];\n  }\n\n};\n\nErrorPlugin.install = function (weDebug, options = {}) {\n  if (ErrorPlugin.installed) return;\n  ErrorPlugin.installed = true;\n  const badgeOption = options.badge || {};\n  const copyOption = options.copyRule || {};\n  const clearOption = options.clearRule || {};\n  const errorBadge = weDebug.createBadge(Object.assign({}, {\n    key: 'error',\n    value: 0,\n    color: 'red',\n    show: () => true,\n    draggable: true,\n    position: {\n      right: 0,\n      top: 10\n    }\n  }, badgeOption));\n  const copyErrStackRule = weDebug.createFormRule(Object.assign({}, {\n    title: '获取错误信息',\n    desc: '复制错误信息到剪切板',\n    type: 'button',\n    state: {\n      disabled: false\n    },\n    handler: {\n      bindTap(state) {\n        if (!state.disabled) {\n          wx.setClipboardData({\n            data: JSON.stringify(errManage.get(), null, 2)\n          });\n        }\n      }\n\n    }\n  }, copyOption));\n  const clearErrStackRule = weDebug.createFormRule(Object.assign({}, {\n    title: '清空错误信息',\n    desc: '',\n    type: 'button',\n    state: {\n      name: '清空',\n      disabled: false\n    },\n    handler: {\n      bindTap(state) {\n        if (!state.disabled) {\n          errManage.clear();\n          updateState();\n        }\n      }\n\n    }\n  }, clearOption));\n  weDebug.addBadge([errorBadge]);\n  weDebug.addFormRule([copyErrStackRule, clearErrStackRule]);\n\n  function updateState() {\n    const errStack = errManage.get();\n    const errLen = errStack.length;\n    errorBadge.emit({\n      value: errLen\n    });\n    copyErrStackRule.emit({\n      meta: errLen\n    });\n  }\n\n  wx.onError(err => {\n    errManage.add(err);\n    updateState();\n  });\n  wx.onAppRoute(() => {\n    updateState();\n  });\n};\n\nvar _default = ErrorPlugin;\nexports.default = _default;"]}